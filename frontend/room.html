<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="icon"
      type="image/x-icon"
      href="https://cdn-icons-png.flaticon.com/512/11563/11563315.png"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibe Room</title>
    <link rel="stylesheet" href="/room.css" />
    <style>
      /* Non-layout critical styles from original file, kept for functionality */
      .spinner {
        animation: rotate 2s linear infinite;
        width: 20px;
        height: 20px;
      }
      .spinner .path {
        stroke: hsl(var(--primary));
        stroke-linecap: round;
        animation: dash 1.5s ease-in-out infinite;
      }
      @keyframes rotate {
        100% {
          transform: rotate(360deg);
        }
      }
      @keyframes dash {
        0% {
          stroke-dasharray: 1, 150;
          stroke-dashoffset: 0;
        }
        50% {
          stroke-dasharray: 90, 150;
          stroke-dashoffset: -35;
        }
        100% {
          stroke-dasharray: 90, 150;
          stroke-dashoffset: -124;
        }
      }

      /* These classes are controlled by JS to show/hide the correct link input form */
      .is-guest .host-only-form {
        display: none;
      }
      .is-host .guest-only-form {
        display: none;
      }
      .host-only-form,
      .guest-only-form {
        display: none;
      }
      .is-host .host-only-form,
      .is-guest .guest-only-form {
        display: block;
      }
    </style>
  </head>
  <body>
    <div id="room-background"></div>
    <div id="toast-container"></div>
    <div id="audio-unlock-overlay">
      <h1>Click anywhere to join the vibe...</h1>
    </div>
    <div id="youtube-player"></div>

    <div id="room-view-wrapper">
      <header class="page-header">
        <div class="room-title-container">
          <svg
            class="header-icon"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path
              d="M12 3v10.55c-.59-.34-1.27-.55-2-.55c-2.21 0-4 1.79-4 4s1.79 4 4 4s4-1.79 4-4V7h4V3h-6Z"
            />
          </svg>
          <h1 id="room-name-display">Loading Vibe...</h1>
        </div>
        <div class="header-actions">
          <div class="listener-count">
            <svg
              class="header-icon"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path
                d="M12 1a9 9 0 0 0-9 9v7a3 3 0 0 0 3 3h1v-4h-2v-3a7 7 0 0 1 7-7 7 7 0 0 1 7 7v3h-2v4h1a3 3 0 0 0 3-3v-7a9 9 0 0 0-9-9Z"
              />
            </svg>
            <span id="listener-count-display">1</span>Â listening
          </div>
          <a href="/" class="btn-leave">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path
                d="M16 17v-3H9v-4h7V7l5 5-5 5M14 2a2 2 0 0 1 2 2v2h-2V4H5v16h9v-2h2v2a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9Z"
              />
            </svg>
            Leave Vibe
          </a>
        </div>
      </header>

      <div class="room-layout">
        <!-- Music Panel -->
        <div class="panel music-panel">
          <div id="now-playing-container" class="now-playing-card">
            <img
              class="now-playing-art"
              src="/placeholder.svg"
              id="now-playing-art"
              alt="Album Art"
            />
            <div class="now-playing-info">
              <p id="now-playing-name">Nothing Playing</p>
              <p id="now-playing-artist">Add a song to start the vibe</p>
            </div>
          </div>
          <div class="playback-controls" id="host-controls-wrapper">
            <!-- This section is now visible to everyone -->
            <div class="time-display">
              <span id="current-time">0:00</span>
              <span id="total-time">0:00</span>
            </div>
            <div id="progress-bar-container" class="progress-bar-container">
              <div id="progress-bar" class="progress-bar"></div>
            </div>

            <!-- This section contains controls -->
            <div class="media-controls">
              <div class="volume-controls">
                <button class="icon-btn" id="volume-btn">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"
                    />
                  </svg>
                </button>
                <input
                  type="range"
                  id="volume-slider"
                  class="volume-slider"
                  min="0"
                  max="100"
                  value="80"
                />
              </div>

              <!-- This div wraps ONLY the host buttons -->
              <div class="host-only-controls">
                <div class="media-buttons-group">
                  <button class="icon-btn" id="prev-btn">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      fill="currentColor"
                    >
                      <path d="M6 18V6h2v12H6m3.5-6L18 6v12l-8.5-6Z" />
                    </svg>
                  </button>
                  <button class="icon-btn play-btn" id="play-pause-btn">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      fill="currentColor"
                    >
                      <path d="M8 5.14v14l11-7-11-7Z" />
                    </svg>
                  </button>
                  <button class="icon-btn" id="next-btn">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      fill="currentColor"
                    >
                      <path d="m6 18 8.5-6L6 6v12zm10-12v12h2V6h-2z" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="panel-section queue-section">
            <h4 class="section-title">Up Next</h4>
            <div id="queue-list" class="scrollable-list">
              <!-- JS will populate this -->
            </div>
          </div>
          <div class="panel-section add-vibe-section">
            <div id="add-vibe-wrapper">
              <div class="host-only-form">
                <h4 class="section-title">Add by Link</h4>
                <form id="host-link-form" class="link-form">
                  <input
                    type="text"
                    id="host-link-input"
                    class="link-input-field"
                    placeholder="Paste YouTube link to add..."
                    autocomplete="off"
                  />
                  <button type="submit" class="form-action-btn">Add</button>
                </form>
              </div>
              <div class="guest-only-form">
                <h4 class="section-title">Suggest by Link</h4>
                <form id="guest-link-form" class="link-form">
                  <input
                    type="text"
                    id="guest-link-input"
                    class="link-input-field"
                    placeholder="Paste YouTube link to suggest..."
                    autocomplete="off"
                  />
                  <button type="submit" class="form-action-btn">Suggest</button>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Social Panel -->
        <div class="panel social-panel">
          <div class="panel-tabs">
            <button class="tab-btn active" data-tab="chat">
              <svg
                class="header-icon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"
                />
              </svg>
              <span>Chat</span>
            </button>
            <button class="tab-btn" data-tab="users">
              <svg
                class="header-icon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                <circle cx="9" cy="7" r="4" />
                <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                <path d="M16 3.13a4 4 0 0 1 0 7.75" />
              </svg>
              <span>Users<span id="user-count-display">(1)</span></span>
            </button>
            <button class="tab-btn" data-tab="suggestions">
              <svg
                class="header-icon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M4 19h16v-2H4v2zM4 5v2h16V5H4zm2 11h12v-2H6v2zm3-4h6V9H9v3z"
                />
              </svg>
              <span
                >Suggestions<span id="suggestions-count-display"
                  >(0)</span
                ></span
              >
            </button>
          </div>
          <div id="chat-content" class="tab-content active">
            <div id="chat-messages" class="scrollable-list">
              <!-- JS will populate this -->
            </div>
            <form id="chat-form" class="chat-form">
              <input
                type="text"
                id="chat-input"
                placeholder="Say something..."
                autocomplete="off"
                required
              />
              <button type="submit" id="send-btn">Send</button>
            </form>
          </div>
          <div id="users-content" class="tab-content">
            <div id="user-list" class="scrollable-list">
              <!-- JS will populate this -->
            </div>
          </div>
          <div id="suggestions-content" class="tab-content">
            <div id="suggestions-list" class="scrollable-list">
              <!-- JS will populate this -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://vibes-fqic.onrender.com/socket.io/socket.io.js"></script>
    <script src="/room.js"></script>
    <script>
      var tag = document.createElement("script");
      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName("script")[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    </script>
  </body>
</html>
